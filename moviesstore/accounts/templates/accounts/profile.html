{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="p-3">
  <div class="container">
    <div class="row mt-3">
      <div class="col-md-6 mx-auto mb-3">
        <h2>My Profile</h2>
        <hr />
        
        {% if template_data.success %}
        <div class="alert alert-success alert-dismissible fade show" role="alert">
          {{ template_data.success }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endif %}
        
        <div class="card">
          <div class="card-body">
            <div class="text-center mb-4">
              {% if template_data.profile.profile_picture %}
                <img src="{{ template_data.profile.profile_picture.url }}" 
                     alt="Profile Picture" 
                     class="img-thumbnail rounded-circle" 
                     style="width: 150px; height: 150px; object-fit: cover;">
              {% else %}
                <div class="img-thumbnail rounded-circle d-inline-flex align-items-center justify-content-center" 
                     style="width: 150px; height: 150px; background-color: #e9ecef;">
                  <i class="fas fa-user fa-3x text-muted"></i>
                </div>
              {% endif %}
            </div>
            
            <h5 class="text-center mb-4">{{ user.username }}</h5>
            
            <!-- Profile Picture Section -->
            <form method="POST" enctype="multipart/form-data" class="mb-4">
              {% csrf_token %}
              <h6 class="mb-3">Profile Picture</h6>
              <div class="mb-3">
                <label for="{{ template_data.form.profile_picture.id_for_label }}" class="form-label">
                  Update Profile Picture
                </label>
                {{ template_data.form.profile_picture }}
                {% if template_data.form.profile_picture.errors %}
                  <div class="text-danger mt-1">
                    {{ template_data.form.profile_picture.errors }}
                  </div>
                {% endif %}
                <div class="form-text">Upload a new profile picture (JPG, PNG, etc.)</div>
              </div>
              
              <div class="d-grid">
                <button type="submit" name="submit_picture" class="btn btn-primary">Update Profile Picture</button>
              </div>
            </form>
            
            <hr />
            
            <!-- Max Content Rating Section -->
            <form method="POST" class="mb-4">
              {% csrf_token %}
              <h6 class="mb-3">Content Rating Preference</h6>
              <div class="mb-3">
                <label for="{{ template_data.rating_form.max_content_rating.id_for_label }}" class="form-label">
                  Maximum Content Rating
                </label>
                {{ template_data.rating_form.max_content_rating }}
                {% if template_data.rating_form.max_content_rating.errors %}
                  <div class="text-danger mt-1">
                    {{ template_data.rating_form.max_content_rating.errors }}
                  </div>
                {% endif %}
                <div class="form-text">
                  Movies with a rating higher than your selection will be blurred and disabled on the movies page.
                </div>
              </div>
              
              <div class="d-grid">
                <button type="submit" name="submit_rating" class="btn btn-primary">Update Content Rating</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock content %}

